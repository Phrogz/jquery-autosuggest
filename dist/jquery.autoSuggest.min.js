/*! jQuery AutoSuggest - v2.0.0 - 2012-07-09
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c={}.hasOwnProperty;a=jQuery,b=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),a.fn.autoSuggest=function(d,e){var f,g,h,i,j,k,l;g={asHtmlID:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,selectionClick:null,selectionAdded:null,selectionRemoved:function(a){return a.remove()},formatList:null,beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},resultClick:null,resultsComplete:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"}},e=a.extend({},g,e),f=function(a){var b;return function(){var d;d=[];for(b in a){if(!c.call(a,b))continue;d.push(b)}return d}().length},k=function(){var b,c,d,f,g,h,i;f=e.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){b={},i=f.split("&");for(g=0,h=i.length;g<h;g++){c=i[g];if(c==="")continue;d=c.split("=",2),d.length&&(b[d[0]]=d[1])}f=b}return f},h=function(b){return a("<span/>").text(b).html()},i=function(a){if(a)return a.replace(/"/g,'\\"')},l=null,j=function(){switch(a.type(d)){case"function":return d;case"string":return function(b,c){var f,g,h;return h={},h[""+e.queryParam]=encodeURIComponent(decodeURIComponent(b)),e.retrieveLimit&&(h[e.limitParam]=encodeURIComponent(e.retrieveLimit)),g=k(),a.type(g)==="object"&&a.extend(h,g),f=a.extend({},e.ajaxOptions,{url:d,data:h}),l=a.ajax(f).done(function(a){return c(e.retrieveComplete.call(this,a),b)})};case"array":case"object":return function(a,b){return b(d,a)}}}();if(!j)return;return this.each(function(c){var d,f,g,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;p=!1,o=a(this),e.asHtmlID?(c=e.asHtmlID,k=c):(c=""+c+Math.floor(Math.random()*100),k="as-input-"+c),o.attr({autocomplete:"off",id:k}),o.addClass("as-input"),e.usePlaceholder?o.attr({placeholder:e.startText}):o.val(e.startText),q=function(b,d){var j,k;return g.add(b[e.selectedValuesProp]),k=a('<li class="as-selection-item" id="as-selection-'+d+'" data-value="'+i(h(b[e.selectedValuesProp]))+'"></li>'),k.click(function(){c=a(this),a.isFunction(e.selectionClick)&&e.selectionClick.call(this,c),F.children().removeClass("selected"),c.addClass("selected")}),k.mousedown(function(){p=!1}),j=a('<a class="as-close">&times;</a>'),j.click(function(){return g.remove(b[e.selectedValuesProp]),a.isFunction(e.selectionRemoved)&&e.selectionRemoved.call(this,k),p=!0,o.focus(),!1}),typeof b[e.selectedItemProp]!="string"?f.before(k.append(b[e.selectedItemProp]).prepend(j)):f.before(k.text(b[e.selectedItemProp]).prepend(j)),a.isFunction(e.selectionAdded)&&e.selectionAdded.call(this,f.prev(),b[e.selectedValuesProp]),f.prev()},o.wrap('<ul class="as-selections" id="as-selections-'+c+'"></ul>').wrap('<li class="as-original" id="as-original-'+c+'"></li>'),F=a("#as-selections-"+c),f=a("#as-original-"+c),D=a('<div class="as-results" id="as-results-'+c+'"></div>'),E=a('<ul class="as-list"></ul>'),m=a('<input type="hidden" class="as-values" name="as_values_'+c+'" id="as-values-'+c+'" />'),g=new b(m),z="",r=null,G=null,A="",v=!1,u=null,y=0,a.isFunction(e.start)&&e.start.call(this,{add:function(b){var c,d;return c=a(F).find("li").length,d=q(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return g.remove(a),F.find('li[data-value="'+h(a)+'"]').remove()}});switch(a.type(e.preFill)){case"string":M=e.preFill.split(",");for(I=0,K=M.length;I<K;I++)H=M[I],s={},s[""+e.selectedValuesProp]=H,H!==""&&q(s,"000"+n);z=e.preFill;break;case"array":z="";if(e.preFill.length){N=e.preFill;for(n=J=0,L=N.length;J<L;n=++J)s=N[n],x=s[e.selectedValuesProp],typeof x=="undefined"&&(x=""),z+=x+",",x!==""&&q(s,"000"+n)}}return z!==""&&(o.val(""),F.find("li.as-selection-item").addClass("blur").removeClass("selected")),o.after(m),F.click(function(){p=!0,o.focus()}),F.mousedown(function(){p=!1}),F.after(D),t=function(){var a;a=o.val().replace(/[\\]+|[\/]+/g,"");if(a===A)return;return A=a,a.length>=e.minChars?(F.addClass("loading"),C(a)):(F.removeClass("loading"),D.hide())},C=function(b){if(a.isFunction(e.beforeRetrieve))return b=e.beforeRetrieve.call(this,b),d(),j(b,B)},B=function(b,d){var f,i,j,k,l,m,n,r,t,u,w,x,z;e.matchCase||(d=d.toLowerCase()),d=d.replace("(","(","g").replace(")",")","g"),j=0,D.hide().html(E.html("")),l=0;for(t=0,w=b.length;t<w;t++){s=b[t],y++,i=!1;if(e.searchObjProps==="value")n=s.value;else{n="",z=e.searchObjProps.split(",");for(u=0,x=z.length;u<x;u++)k=z[u],n+=""+s[a.trim(k)]+" "}n&&(e.matchCase||(n=n.toLowerCase()),n.indexOf(d)!==-1&&!g.exist(s[e.selectedValuesProp])&&(i=!0));if(i){f=a('<li class="as-result-item" id="as-result-item-'+l+'"></li>'),f.click(function(){var d,f;c=a(this),f=c.data("data"),d=f.num,F.find("#as-selection-"+d).length<=0&&!v&&(b=f.attributes,o.val("").focus(),A="",q(b,d),a.isFunction(e.resultClick)&&e.resultClick.call(this,f),D.hide()),v=!1}),f.mousedown(function(){p=!1}),f.mouseover(function(){c=a(this),E.find("li").removeClass("active"),c.addClass("active")}),f.data("data",{attributes:b[l],num:y}),r=a.extend({},b[l]),d=d.replace(/"/g,'\\"'),m=e.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(d)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(d)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof r[e.selectedItemProp]=="string"?(r[e.selectedItemProp]=h(r[e.selectedItemProp]),e.resultsHighlight&&d.length>0&&(r[e.selectedItemProp]=r[e.selectedItemProp].replace(m,"<em>$1</em>"))):r[e.selectedItemProp].html(r[e.selectedItemProp].html().replace(m,"<em>$1</em>")),e.formatList?f=e.formatList.call(this,r,f):f=f.html(r[e.selectedItemProp]),E.append(f),r=null,j++;if(e.retrieveLimit&&e.retrieveLimit===j)break}l+=1}F.removeClass("loading"),j<=0&&E.html('<li class="as-message">'+e.emptyText+"</li>"),E.css({width:F.outerWidth()}),(j>0||!e.showResultListWhenNoMatch)&&D.show(),a.isFunction(e.resultsComplete)&&e.resultsComplete.call(this)},w=function(a){var b,c,d;if(D.find(":visible").length){c=D.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=D.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}c.removeClass("active"),d.addClass("active")}},d=function(){if(!l)return;l.abort(),l=null},o.focus(function(){return c=a(this),!e.usePlaceholder&&c.val()===e.startText&&g.isEmpty()?c.val(""):p&&(F.find("li.as-selections-item").removeClass("blur"),c.val()!==""&&(E.css({width:F.outerWidth()}),D.show())),r&&clearInterval(r),r=setInterval(function(){e.showResultList&&(e.selectionLimit&&F.find("li.as-selection-item").length>=e.selectionLimit?(E.html('<li class="as-message">'+e.limitText+"</li>"),D.show()):t())},e.keyDelay),p=!0,e.minChars===0&&C(c.val()),!0}),o.blur(function(){c=a(this),!e.usePlaceholder&&c.val()===""&&g.isEmpty()&&z===""&&e.minChars>0?c.val(e.startText):p&&(F.find("li.as-selection-item").addClass("blur").removeClass("selected"),D.hide()),r&&clearInterval(r)}),o.keydown(function(b){var c,h,i,j,k,l;u=b.keyCode,h=!1;switch(b.keyCode){case 38:b.preventDefault(),w("up");break;case 40:b.preventDefault(),w("down");break;case 8:o.val()===""&&(l=g.getAll(),k=null,l.length?k=l[l.length-1]:k=null,F.children().not(f.prev()).removeClass("selected"),f.prev().hasClass("selected")?(g.remove(k),a.isFunction(e.selectionRemoved)&&e.selectionRemoved.call(this,f.prev())):(a.isFunction(e.selectionClick)&&e.selectionClick.call(this,f.prev()),f.prev().addClass("selected"))),o.val().length===1&&(D.hide(),A="",d()),D.find(":visible").length&&(G&&clearTimeout(G),G=setTimeout(function(){t()},e.keyDelay));break;case 9:case 188:e.canGenerateNewSelections&&(v=!0,i=o.val().replace(/(,)/g,""),c=D.find("li.active:first"),i!==""&&!g.exist(i)&&i.length>=e.minChars&&c.length===0&&(b.preventDefault(),j={},j[""+e.selectedItemProp]=i,j[""+e.selectedValuesProp]=i,q(j,"00"+(F.find("li").length+1)),o.val(""),d()));break;case 13:v=!1,c=D.find("li.active:first"),c.length&&(c.click(),D.hide()),(e.neverSubmit||c.length)&&b.preventDefault();break;case 27:e.preventPropagationOnEscape&&D.find(":visible").length&&b.stopPropagation();break;case 16:case 20:d(),D.hide()}})})}}).call(this);