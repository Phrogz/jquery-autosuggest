/*! jQuery AutoSuggest - v2.0.0 - 2012-07-08
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c={}.hasOwnProperty;a=jQuery,b=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),a.fn.autoSuggest=function(d,e){var f,g,h,i,j,k,l;g={asHtmlID:!1,startText:"Enter Name Here",usePlaceholder:!1,emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,neverSubmit:!1,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:function(){},selectionClick:function(a){},selectionAdded:function(a){},selectionRemoved:function(a){return a.remove()},formatList:null,beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},resultClick:function(a){},resultsComplete:function(){},preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"}},e=a.extend({},g,e),f=function(a){var b;return function(){var d;d=[];for(b in a){if(!c.call(a,b))continue;d.push(b)}return d}().length},k=function(){var b,c,d,f,g,h,i;f=e.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){b={},i=f.split("&");for(g=0,h=i.length;g<h;g++){c=i[g];if(c==="")continue;d=c.split("=",2),d.length&&(b[d[0]]=d[1])}f=b}return f},h=function(b){return a("<span/>").text(b).html()},i=function(a){if(a)return a.replace(/"/g,'\\"')},l=null,j=function(){switch(a.type(d)){case"function":return d;case"string":return function(b,c){var f,g,h;return h={},h[""+e.queryParam]=encodeURIComponent(decodeURIComponent(b)),e.retrieveLimit&&(h[e.limitParam]=encodeURIComponent(e.retrieveLimit)),g=k(),a.type(g)==="object"&&a.extend(h,g),f=a.extend({},e.ajaxOptions,{url:d,data:h}),l=a.ajax(f).done(function(a){return c(e.retrieveComplete.call(this,a),b)})};case"array":case"object":return function(a,b){return b(d,a)}}}();if(!j)return;return this.each(function(c){var d,f,g,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;e.asHtmlID?(c=e.asHtmlID,I=c):(c=""+c+Math.floor(Math.random()*100),I="as-input-"+c),m=a(this),m.attr({autocomplete:"off",id:I}),m.addClass("as-input"),e.usePlaceholder?m.attr({placeholder:e.startText}):m.val(e.startText),g=function(b,c){var f,g;return d.add(b[e.selectedValuesProp]),g=a('<li class="as-selection-item" id="as-selection-'+c+'" data-value="'+i(h(b[e.selectedValuesProp]))+'"></li>'),g.click(function(){var b;b=a(this),e.selectionClick.call(this,b),C.children().removeClass("selected"),b.addClass("selected")}),g.mousedown(function(){var a;a=!1}),f=a('<a class="as-close">&times;</a>'),f.click(function(){var a;return d.remove(b[e.selectedValuesProp]),e.selectionRemoved.call(this,g),a=!0,m.focus(),!1}),typeof b[e.selectedItemProp]!="string"?v.before(g.append(b[e.selectedItemProp]).prepend(f)):v.before(g.text(b[e.selectedItemProp]).prepend(f)),e.selectionAdded.call(this,v.prev(),b[e.selectedValuesProp]),v.prev()},n=!1,m.wrap('<ul class="as-selections" id="as-selections-'+c+'"></ul>').wrap('<li class="as-original" id="as-original-'+c+'"></li>'),C=a("#as-selections-"+c),v=a("#as-original-"+c),A=a('<div class="as-results" id="as-results-'+c+'"></div>'),B=a('<ul class="as-list"></ul>'),H=a('<input type="hidden" class="as-values" name="as_values_'+c+'" id="as-values-'+c+'" />'),e.start.call(this,{add:function(b){var c,d;return c=a(C).find("li").length,d=g(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return d.remove(a),C.find('li[data-value="'+h(a)+'"]').remove()}}),d=new b(H),w="";switch(a.type(e.preFill)){case"string":N=e.preFill.split(",");for(J=0,L=N.length;J<L;J++)G=N[J],p={},p[""+e.selectedValuesProp]=G,G!==""&&g(p,"000"+k);w=e.preFill;break;case"array":w="";if(e.preFill.length){O=e.preFill;for(k=K=0,M=O.length;K<M;k=++K)p=O[k],t=p[e.selectedValuesProp],typeof t=="undefined"&&(t=""),w+=t+",",t!==""&&g(p,"000"+k)}}return w!==""&&(m.val(""),C.find("li.as-selection-item").addClass("blur").removeClass("selected")),m.after(H),C.click(function(){n=!0,m.focus()}),C.mousedown(function(){n=!1}),C.after(A),o=null,E=null,x="",F=0,D=!1,r=null,u=0,q=function(){var a;a=m.val().replace(/[\\]+|[\/]+/g,"");if(a===x)return;return x=a,a.length>=e.minChars?(C.addClass("loading"),z(a)):(C.removeClass("loading"),A.hide())},z=function(b){if(a.isFunction(e.beforeRetrieve))return b=e.beforeRetrieve.call(this,b),f(),j(b,y)},y=function(b,c){var f,i,j,k,l,o,q,r,s,t,v,w,y;e.matchCase||(c=c.toLowerCase()),c=c.replace("(","(","g").replace(")",")","g"),j=0,A.hide().html(B.html("")),l=0;for(s=0,v=b.length;s<v;s++){p=b[s],u++,i=!1;if(e.searchObjProps==="value")q=p.value;else{q="",y=e.searchObjProps.split(",");for(t=0,w=y.length;t<w;t++)k=y[t],q+=""+p[a.trim(k)]+" "}q&&(e.matchCase||(q=q.toLowerCase()),q.search(c)!==-1&&!d.exist(p[e.selectedValuesProp])&&(i=!0));if(i){f=a('<li class="as-result-item" id="as-result-item-'+l+'"></li>'),f.click(function(){var c,d,f;c=a(this),f=c.data("data"),d=f.num,C.find("#as-selection-"+d).length<=0&&!D&&(b=f.attributes,m.val("").focus(),x="",g(b,d),e.resultClick.call(this,f),A.hide()),D=!1}),f.mousedown(function(){n=!1}),f.mouseover(function(){var b;b=a(this),B.find("li").removeClass("active"),b.addClass("active")}),f.data("data",{attributes:b[l],num:u}),r=a.extend({},b[l]),c=c.replace(/"/g,'\\"'),e.matchCase?o=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(c)+")(?![^<>]*>)(?![^&;]+;)","g"):o=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+h(c)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof r[e.selectedItemProp]=="string"?(r[e.selectedItemProp]=h(r[e.selectedItemProp]),e.resultsHighlight&&c.length>0&&(r[e.selectedItemProp]=r[e.selectedItemProp].replace(o,"<em>$1</em>"))):r[e.selectedItemProp].html(r[e.selectedItemProp].html().replace(o,"<em>$1</em>")),e.formatList?f=e.formatList.call(this,r,f):f=f.html(r[e.selectedItemProp]),B.append(f),r=null,j++;if(e.retrieveLimit&&e.retrieveLimit===j)break}l+=1}return C.removeClass("loading"),j<=0&&B.html('<li class="as-message">'+e.emptyText+"</li>"),B.css({width:C.outerWidth()}),(j>0||!e.showResultListWhenNoMatch)&&A.show(),e.resultsComplete.call(this)},s=function(a){var b,c,d;if(A.find(":visible").length){c=A.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=A.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}return c.removeClass("active"),d.addClass("active")}},f=function(){if(!l)return;return l.abort(),l=null},m.focus(function(){var b;return b=a(this),!e.usePlaceholder&&b.val()===e.startText&&d.isEmpty()?b.val(""):n&&(C.find("li.as-selections-item").removeClass("blur"),b.val()!==""&&(B.css({width:C.outerWidth()}),A.show())),o&&clearInterval(o),o=setInterval(function(){e.showResultList&&(e.selectionLimit&&C.find("li.as-selection-item").length>=e.selectionLimit?(B.html('<li class="as-message">'+e.limitText+"</li>"),A.show()):q())},e.keyDelay),n=!0,e.minChars===0&&z(b.val()),!0}),m.blur(function(){var b;b=a(this),!e.usePlaceholder&&b.val()===""&&d.isEmpty()&&w===""&&e.minChars>0?b.val(e.startText):n&&(C.find("li.as-selection-item").addClass("blur").removeClass("selected"),A.hide()),o&&clearInterval(o)}),m.keydown(function(a){var b,c,h,i,j;r=a.keyCode,c=!1;switch(a.keyCode){case 38:a.preventDefault(),s("up");break;case 40:a.preventDefault(),s("down");break;case 8:m.val()===""&&(i=d.getAll(),i.length?i=i[i.length-1]:i=null,C.children().not(v.prev()).removeClass("selected"),v.prev().hasClass("selected")?(d.remove(i),e.selectionRemoved.call(this,v.prev())):(e.selectionClick.call(this,v.prev()),v.prev().addClass("selected"))),m.val().length===1&&(A.hide(),x="",f()),A.find(":visible").length&&(E&&clearTimeout(E),E=setTimeout(function(){q()},e.keyDelay));break;case 9:case 188:e.canGenerateNewSelections&&(D=!0,h=m.val().replace(/(,)/g,""),b=A.find("li.active:first"),h!==""&&!d.exist(h)&&h.length>=e.minChars&&b.length===0&&(a.preventDefault(),j={},j[""+e.selectedItemProp]=h,j[""+e.selectedValuesProp]=h,g(j,"00"+(C.find("li").length+1)),m.val(""),f()));break;case 13:D=!1,b=A.find("li.active:first"),b.length&&(b.click(),A.hide()),(e.neverSubmit||b.length)&&a.preventDefault();break;case 27:e.preventPropagationOnEscape&&A.find(":visible").length&&a.stopPropagation();break;case 16:case 20:f(),A.hide()}})})}}).call(this);