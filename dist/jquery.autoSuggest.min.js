/*! jQuery AutoSuggest - v2.1.0 - 2013-03-03
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2013 Jan Philipp; Licensed MIT, GPL */
(function(){var e,t,n,r,i,s,o,u=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},a=[].slice;e=jQuery,i=function(){function t(){}return t.prototype._=void 0,t.escapeQuotes=function(e){if(e)return e.replace(/"/g,'\\"')},t.escapeHtml=function(t){return e("<span/>").text(t).html()},t.setPlaceholderEnabled=function(e,t){var n,r,i;r=["placeholder","disabled-placeholder"],t?(n=r[1],i=r[0]):(n=r[0],i=r[1]);if(e.attr(i)||!e.attr(n))return;e.attr(i,function(){return e.attr(n)}),e.removeAttr(n)},t}(),t=function(){function t(){}return t.prototype._=void 0,t.getExtraParams=function(t){var n,r,i,s,o,u,a;s=t.extraParams,e.isFunction(s)&&(s=s(this));if(e.type(s)==="string"){n={},a=s.split("&");for(o=0,u=a.length;o<u;o++){r=a[o];if(r==="")continue;i=r.split("=",2),i.length&&(n[i[0]]=i[1])}s=n}return s},t}(),r=function(){function t(e,t){this.hiddenField=e,this.items=t!=null?t:[]}return t.prototype._=void 0,t.prototype.hiddenField=null,t.prototype.items=null,t.prototype.syncToHiddenField=function(){var e,t,n,r,i;if(!this.hiddenField)return;t="",i=this.items;for(n=0,r=i.length;n<r;n++)e=i[n],t+=","+e;t&&(t+=","),this.hiddenField.val(t||",")},t.prototype.add=function(e){this.exist(e)||this.items.push(e),this.syncToHiddenField()},t.prototype.remove=function(t){this.items=e.grep(this.items,function(e){return e!==t}),this.syncToHiddenField()},t.prototype.isEmpty=function(){return this.items.length===0},t.prototype.exist=function(t){return e.inArray(t,this.items)!==-1},t.prototype.getAll=function(){return this.items.slice(0)},t.prototype.clear=function(){this.items=[],this.syncToHiddenField()},t}(),n=function(){function t(){}return t.onSelectionAdd=function(t,n,r,s,o,u){var a;a=s.onSelectionAdd.call(t,n,r,s),i.setPlaceholderEnabled(t,u.length===0),e.isFunction(s.afterSelectionAdd)&&s.afterSelectionAdd.call(t,a,o,u)},t.onSelectionRemove=function(t,n,r,s,o){e.isFunction(r.onSelectionRemove)&&r.onSelectionRemove.call(t,n,r),i.setPlaceholderEnabled(t,o.length===0),e.isFunction(r.afterSelectionRemove)&&r.afterSelectionRemove.call(t,n,s,o)},t.onSelectionClick=function(t,n,r,s,o){e.isFunction(r.afterSelectionClick)&&r.afterSelectionClick.call(t,n,s,o),i.setPlaceholderEnabled(t,o.length===0)},t.onAjaxRequestDone=function(t,n,r){e.isFunction(r.onAjaxRequestDone)&&n.done(r.onAjaxRequestDone)},t.onAjaxRequestFail=function(t,n,r){e.isFunction(r.onAjaxRequestFail)&&n.fail(r.onAjaxRequestFail)},t.onAjaxRequestAlways=function(t,n,r){e.isFunction(r.onAjaxRequestAlways)&&n.always(r.onAjaxRequestAlways)},t}(),s={asHtmlID:!1,useOriginalInputName:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",emptyTextPlaceholder:/\{\d+\}/,limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(e,t,n){return e.before(t),e.prev()},onSelectionRemove:function(e,t){return t.fadeOut?e.fadeOut(t.fadeOut,function(){return e.remove()}):e.remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,onResultItemClick:null,afterResultListShow:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,remoteFilter:!1},o={init:function(o,a){var f,l;a=e.extend({},s,a),f=null,a.remoteFilter==="auto"&&(a.remoteFilter=e.type(o)==="string"),l=function(){switch(e.type(o)){case"function":return o;case"string":return function(r,i){var s,u,l,c;c={},c[""+a.queryParam]=encodeURIComponent(decodeURIComponent(r)),a.retrieveLimit&&(c[a.limitParam]=encodeURIComponent(a.retrieveLimit)),u=t.getExtraParams(a),e.type(u)==="object"&&e.extend(c,u),s=e.extend({},a.ajaxOptions,{url:o,data:c}),l=function(t){return e.isFunction(a.afterRequest)&&(t=a.afterRequest.apply(this,[t])),i(t,r)},f=e.ajax(s).done(l),n.onAjaxRequestDone(this,f,a),n.onAjaxRequestFail(this,f,a),n.onAjaxRequestAlways(this,f,a)};case"array":case"object":return function(e,t){return t(o,e)}}}();if(!l)return;return this.each(function(){var t,s,o,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z;a.inputAttrs=e.extend(a.inputAttrs,{}),w=!1,y=e(this),h=null,p=null,d=null,v=null,m=null,a.asHtmlID?(h=a.asHtmlID,p=h,v="as-values-"+h,a.useOriginalInputName?(m=y.attr("name"),y.attr({name:"old_"+y.attr("name")})):m="as_values_"+h):(h=""+(h||"")+Math.floor(Math.random()*100),p="as-input-"+h,v="as-values-"+h,a.useOriginalInputName?(m=y.attr("name"),y.attr({name:"old_"+y.attr("name")})):m="as_values_"+h),a.inputAttrs.id=p,a.usePlaceholder||(a.inputAttrs.placeholder=a.startText),y.attr(a.inputAttrs),y.addClass("as-input"),a.usePlaceholder||y.val(a.startText),y.wrap('<ul class="as-selections" id="as-selections-'+h+'"></ul>').wrap('<li class="as-original" id="as-original-'+h+'"></li>'),H=e("#as-selections-"+h),b=e("#as-original-"+h),D=e('<div class="as-results" id="as-results-'+h+'"></div>'),P=e('<ul class="as-list"></ul>'),d=e('<input type="hidden" class="as-values" name="'+m+'" id="'+v+'" />'),c=new r(d),E=null,B=null,A="",N=!1,T=null,L=0,_={add:function(t){var n,r;n=e(H).find("li").length,r=s(t,"u"+n),r!=null&&r.addClass("blur")},remove:function(e){c.remove(e),H.find('li[data-value="'+i.escapeHtml(e)+'"]').remove()}},o=function(){return{add:_.add,remove:_.remove}},y.bind("addSelection",function(e,t){return _.add(t)}),y.bind("removeSelection",function(e,t){return _.remove(t)}),s=function(t,r){var s,o;return c.add(t[a.selectedValuesProp]),o=e('<li class="as-selection-item" id="as-selection-'+r+'" data-value="'+i.escapeQuotes(i.escapeHtml(t[a.selectedValuesProp]))+'"></li>'),o.on({click:function(){h=e(this),n.onSelectionClick(y,h,a,t[a.selectedValuesProp],c.getAll()),H.children().removeClass("selected"),h.addClass("selected")},mousedown:function(){w=!1}}),s=e('<a class="as-close">&times;</a>'),s.click(function(){return c.remove(t[a.selectedValuesProp]),n.onSelectionRemove(y,o,a,null,c.getAll()),w=!0,y.focus(),!1}),typeof t[a.selectedItemProp]!="string"?n.onSelectionAdd(y,b,o.append(t[a.selectedItemProp]).prepend(s),a,t,c.getAll()):n.onSelectionAdd(y,b,o.text(t[a.selectedItemProp]).prepend(s),a,t,c.getAll()),b.prev()},e.isFunction(a.start)&&a.start.call(this,o());switch(e.type(a.preFill)){case"string":U=a.preFill.split(",");for(F=0,q=U.length;F<q;F++)j=U[F],S={},S[""+a.selectedValuesProp]=j,j!==""&&s(S,"000"+g);break;case"array":if(a.preFill.length){e.isFunction(a.afterRequest)&&(a.preFill=a.afterRequest.call(this,a.preFill)),z=a.preFill;for(g=I=0,R=z.length;I<R;g=++I)S=z[g],k=S[a.selectedValuesProp],typeof k=="undefined"&&(k=""),k!==""&&s(S,"000"+g)}}return c.isEmpty()||(y.val(""),H.find("li.as-selection-item").addClass("blur").removeClass("selected"),i.setPlaceholderEnabled(y,!1)),y.after(d),H.on({click:function(){w=!0,y.focus()},mousedown:function(){H.children().removeClass("selected"),w=!1}}),H.after(D),x=function(){var e,t,n;if(T===46||u.call(function(){n=[];for(t=9;t<31;t++)n.push(t);return n}.apply(this),T)>=0){D.hide();return}e=y.val().replace(/[\\]+|[\/]+/g,"");if(e!==""&&e===A)return;return A=e,e.length>=a.minChars||a.minChars===0&&e.length===0?(H.addClass("loading"),M(e)):(H.removeClass("loading"),D.hide())},M=function(n){return e.isFunction(a.beforeRequest)&&(n=a.beforeRequest.apply(this,[n,a])),t(),l(n,O)},O=function(t,n){var r,o,u,f,l,p,d,v,m,g,b,E,x,T,C;a.matchCase||(n=n.toLowerCase()),n=n.replace("(","(","g").replace(")",")","g"),u=0,D.hide().html(P.html("")),l=0;for(b=0,x=t.length;b<x;b++){S=t[b],L++,o=!1;if(a.searchObjProps==="value")v=S.value;else{v="",C=a.searchObjProps.split(",");for(E=0,T=C.length;E<T;E++)f=C[E],v+=""+S[e.trim(f)]+" "}if(v){a.matchCase||(v=v.toLowerCase());if(!a.searchActive||(v.indexOf(n)!==-1||a.remoteFilter)&&!c.exist(S[a.selectedValuesProp]))o=!0}if(o){r=e('<li class="as-result-item" id="as-result-item-'+l+'"></li>'),r.on({click:function(){var n,r;h=e(this),r=h.data("data"),n=r.num,H.find("#as-selection-"+n).length<=0&&!N&&(t=r.attributes,y.val("").focus(),A="",s(t,n),e.isFunction(a.onResultItemClick)&&a.onResultItemClick.call(this,r),D.hide()),N=!1},mousedown:function(){w=!1},mouseover:function(){h=e(this),P.find("li").removeClass("active"),h.addClass("active")}}),r.data("data",{attributes:t[l],num:L}),g=e.extend({},t[l]),n=n.replace(/"/g,'\\"'),p=a.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof g[a.selectedItemProp]=="string"?(g[a.selectedItemProp]=i.escapeHtml(g[a.selectedItemProp]),a.resultsHighlight&&n.length>0&&(g[a.selectedItemProp]=g[a.selectedItemProp].replace(p,"<em>$1</em>"))):a.resultsHighlight&&n.length>0&&g[a.selectedItemProp].html(g[a.selectedItemProp].html().replace(p,"<em>$1</em>")),a.formatList?r=a.formatList.call(this,g,r):r=r.html(g[a.selectedItemProp]),P.append(r),u++;if(a.retrieveLimit&&a.retrieveLimit===u)break}l+=1}H.removeClass("loading"),u<=0&&(m=a.emptyText,e.type(a.emptyTextPlaceholder)==="regexp"&&(m=m.replace(a.emptyTextPlaceholder,n)),P.html('<li class="as-message">'+m+"</li>")),P.css({width:H.outerWidth()}),d=u>0||a.showResultListWhenNoMatch,d&&D.show(),e.isFunction(a.afterResultListShow)&&a.afterResultListShow.call(this,d)},C=function(e){var t,n,r;if(D.find(":visible").length){n=D.find("li");switch(e){case"down":r=n.eq(0);break;default:r=n.filter(":last")}t=D.find("li.active:first");if(t.length)switch(e){case"down":r=t.next();break;default:r=t.prev()}n.removeClass("active"),r.addClass("active")}},t=function(){if(!f)return;f.abort(),f=null},y.on({focus:function(){return h=e(this),!a.usePlaceholder&&h.val()===a.startText&&c.isEmpty()?h.val(""):w&&(H.find("li.as-selections-item").removeClass("blur"),h.val()!==""&&(P.css({width:H.outerWidth()}),D.show())),E&&clearInterval(E),E=setInterval(function(){a.showResultList&&(a.selectionLimit&&H.find("li.as-selection-item").length>=a.selectionLimit?(P.html('<li class="as-message">'+a.limitText+"</li>"),D.show()):x())},a.keyDelay),w=!0,a.minChars===0&&M(h.val()),!0},blur:function(){h=e(this),!a.usePlaceholder&&h.val()===""&&c.isEmpty()&&a.minChars>0?h.val(a.startText):w&&(H.find("li.as-selection-item").addClass("blur").removeClass("selected"),D.hide()),E&&clearInterval(E),i.setPlaceholderEnabled(h,c.isEmpty())},keydown:function(r){var o,u,f,l,h,p;T=r.keyCode,u=!1;switch(r.keyCode){case 38:r.preventDefault(),C("up");break;case 40:r.preventDefault(),e(":visible",D).length>0?C("down"):(B&&clearTimeout(B),B=setTimeout(function(){x()},a.keyDelay));break;case 8:y.val()===""&&(p=c.getAll(),h=null,p.length?h=p[p.length-1]:h=null,H.children().not(b.prev()).removeClass("selected"),b.prev().hasClass("selected")?(c.remove(h),n.onSelectionRemove(y,b.prev(),a,null,c.getAll())):(n.onSelectionClick(y,b.prev(),a,null,c.getAll()),b.prev().addClass("selected"))),y.val().length===1&&(D.hide(),A="",t()),D.find(":visible").length&&(B&&clearTimeout(B),B=setTimeout(function(){x()},a.keyDelay));break;case 9:case 188:o=D.find("li.active:visible:first"),a.canGenerateNewSelections?(N=!0,f=y.val().replace(/(,)/g,""),f!==""&&!c.exist(f)&&f.length>=a.minChars&&o.length===0&&(r.preventDefault(),l={},l[""+a.selectedItemProp]=f,l[""+a.selectedValuesProp]=f,s(l,"00"+(H.find("li").length+1)),y.val(""),t())):y.val(""),o.length&&(N=!1,o.click(),D.hide(),r.preventDefault());break;case 13:N=!1,o=D.find("li.active:first"),o.length&&(o.click(),D.hide()),(a.neverSubmit||o.length)&&r.preventDefault();break;case 27:a.preventPropagationOnEscape&&D.find(":visible").length&&r.stopPropagation();break;case 16:case 20:t(),D.hide()}i.setPlaceholderEnabled(y,c.isEmpty())}})})},add:function(){var t,n,r,i,s;r=1<=arguments.length?a.call(arguments,0):[],t=e(this);for(i=0,s=r.length;i<s;i++)n=r[i],t.trigger("addSelection",n)},remove:function(){var t,n,r,i,s;r=1<=arguments.length?a.call(arguments,0):[],t=e(this);for(i=0,s=r.length;i<s;i++)n=r[i],t.trigger("removeSelection",n)}},e.fn.autoSuggest=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):o.init.apply(this,arguments)}}).call(this);