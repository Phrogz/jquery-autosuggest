/*! jQuery AutoSuggest - v2.0.0 - 2012-09-01
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c,d,e,f,g;a=jQuery,e=function(){function b(){}return b.prototype._=void 0,b.escapeQuotes=function(a){if(a)return a.replace(/"/g,'\\"')},b.escapeHtml=function(b){return a("<span/>").text(b).html()},b}(),b=function(){function b(){}return b.prototype._=void 0,b.getExtraParams=function(b){var c,d,e,f,g,h,i;f=b.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){c={},i=f.split("&");for(g=0,h=i.length;g<h;g++){d=i[g];if(d==="")continue;e=d.split("=",2),e.length&&(c[e[0]]=e[1])}f=c}return f},b}(),d=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype._=void 0,b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),c=function(){function b(){}return b.onSelectionAdd=function(b,c,d,e,f,g){var h;h=e.onSelectionAdd.call(b,c,d,e);if(a.isFunction(e.afterSelectionAdd))return e.afterSelectionAdd.call(b,h,f,g)},b.onSelectionRemove=function(b,c,d,e,f){a.isFunction(d.onSelectionRemove)&&d.onSelectionRemove.call(b,c,d);if(a.isFunction(d.afterSelectionRemove))return d.afterSelectionRemove.call(b,c,e,f)},b.onSelectionClick=function(b,c,d,e,f){if(a.isFunction(d.afterSelectionClick))return d.afterSelectionClick.call(b,c,e,f)},b}(),f={asHtmlID:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(a,b,c){return a.before(b),a.prev()},onSelectionRemove:function(a,b){return b.fadeOut?a.fadeOut(b.fadeOutDuration,function(){return a.remove}):a.remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,resultClick:null,resultsComplete:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,fadeOutDuration:500},g={init:function(g,h){var i,j;h=a.extend({},f,h),i=null,j=function(){switch(a.type(g)){case"function":return g;case"string":return function(c,d){var e,f,j,k;k={},k[""+h.queryParam]=encodeURIComponent(decodeURIComponent(c)),h.retrieveLimit&&(k[h.limitParam]=encodeURIComponent(h.retrieveLimit)),f=b.getExtraParams(h),a.type(f)==="object"&&a.extend(k,f),e=a.extend({},h.ajaxOptions,{url:g,data:k}),j=function(b){var e;return e=a.isFunction(h.afterRequest)?h.afterRequest.apply(this,[b]):b,d(e,c)},i=a.ajax(e).done(j),h.onAjaxRequestDone&&i.done(h.onAjaxRequestDone),h.onAjaxRequestFail&&i.fail(h.onAjaxRequestFail),h.onAjaxRequestAlways&&i.always(h.onAjaxRequestAlways)};case"array":case"object":return function(a,b){return b(g,a)}}}();if(!j)return;return this.each(function(b){var f,g,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;h.inputAttrs=a.extend(h.inputAttrs,{}),q=!1,p=a(this),b=null,m=null,h.asHtmlID?(b=h.asHtmlID,m=b):(b=""+(b||"")+Math.floor(Math.random()*100),m="as-input-"+b),h.inputAttrs.id=m,h.usePlaceholder&&(h.inputAttrs.placeholder=h.startText),p.attr(h.inputAttrs),p.addClass("as-input"),h.usePlaceholder||p.val(h.startText),p.wrap('<ul class="as-selections" id="as-selections-'+b+'"></ul>').wrap('<li class="as-original" id="as-original-'+b+'"></li>'),F=a("#as-selections-"+b),g=a("#as-original-"+b),D=a('<div class="as-results" id="as-results-'+b+'"></div>'),E=a('<ul class="as-list"></ul>'),n=a('<input type="hidden" class="as-values" name="as_values_'+b+'" id="as-values-'+b+'" />'),l=new d(n),z="",r=null,G=null,A="",v=!1,u=null,y=0,k=function(d,f){var i,j;return l.add(d[h.selectedValuesProp]),j=a('<li class="as-selection-item" id="as-selection-'+f+'" data-value="'+e.escapeQuotes(e.escapeHtml(d[h.selectedValuesProp]))+'"></li>'),j.click(function(){b=a(this),c.onSelectionClick(this,b,h,d[h.selectedValuesProp],l.getAll()),F.children().removeClass("selected"),b.addClass("selected")}),j.mousedown(function(){q=!1}),i=a('<a class="as-close">&times;</a>'),i.click(function(){return l.remove(d[h.selectedValuesProp]),c.onSelectionRemove(this,j,h,null,l.getAll()),q=!0,p.focus(),!1}),typeof d[h.selectedItemProp]!="string"?(g.before,c.onSelectionAdd(this,g,j.append(d[h.selectedItemProp]).prepend(i),h,d[h.selectedValuesProp],l.getAll())):(g.before,c.onSelectionAdd(this,g,j.text(d[h.selectedItemProp]).prepend(i),h,d[h.selectedValuesProp],l.getAll())),g.prev()},a.isFunction(h.start)&&h.start.call(this,{add:function(b){var c,d;return c=a(F).find("li").length,d=k(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return l.remove(a),F.find('li[data-value="'+e.escapeHtml(a)+'"]').remove()}});switch(a.type(h.preFill)){case"string":M=h.preFill.split(",");for(I=0,K=M.length;I<K;I++)H=M[I],s={},s[""+h.selectedValuesProp]=H,H!==""&&k(s,"000"+o);z=h.preFill;break;case"array":z="";if(h.preFill.length){N=h.preFill;for(o=J=0,L=N.length;J<L;o=++J)s=N[o],x=s[h.selectedValuesProp],typeof x=="undefined"&&(x=""),z+=x+",",x!==""&&k(s,"000"+o)}}return z!==""&&(p.val(""),F.find("li.as-selection-item").addClass("blur").removeClass("selected")),p.after(n),F.click(function(){q=!0,p.focus()}),F.mousedown(function(){F.children().removeClass("selected"),q=!1}),F.after(D),t=function(){var a;if(u===46||u>8&&u<32){D.hide();return}a=p.val().replace(/[\\]+|[\/]+/g,"");if(a!==""&&a===A)return;return A=a,a.length>=h.minChars||h.minChars===0&&a.length===0?(F.addClass("loading"),C(a)):(F.removeClass("loading"),D.hide())},C=function(b){return a.isFunction(h.beforeRequest)&&(b=h.beforeRequest.apply(this,[b,h])),f(),j(b,B)},B=function(c,d){var f,g,i,j,m,n,o,r,t,u,w,x,z;h.matchCase||(d=d.toLowerCase()),d=d.replace("(","(","g").replace(")",")","g"),i=0,D.hide().html(E.html("")),m=0;for(t=0,w=c.length;t<w;t++){s=c[t],y++,g=!1;if(h.searchObjProps==="value")o=s.value;else{o="",z=h.searchObjProps.split(",");for(u=0,x=z.length;u<x;u++)j=z[u],o+=""+s[a.trim(j)]+" "}if(o){h.matchCase||(o=o.toLowerCase());if(!h.searchActive||o.indexOf(d)!==-1&&!l.exist(s[h.selectedValuesProp]))g=!0}if(g){f=a('<li class="as-result-item" id="as-result-item-'+m+'"></li>'),f.click(function(){var d,e;b=a(this),e=b.data("data"),d=e.num,F.find("#as-selection-"+d).length<=0&&!v&&(c=e.attributes,p.val("").focus(),A="",k(c,d),a.isFunction(h.resultClick)&&h.resultClick.call(this,e),D.hide()),v=!1}),f.mousedown(function(){q=!1}),f.mouseover(function(){b=a(this),E.find("li").removeClass("active"),b.addClass("active")}),f.data("data",{attributes:c[m],num:y}),r=a.extend({},c[m]),d=d.replace(/"/g,'\\"'),n=h.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(d)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(d)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof r[h.selectedItemProp]=="string"?(r[h.selectedItemProp]=e.escapeHtml(r[h.selectedItemProp]),h.resultsHighlight&&d.length>0&&(r[h.selectedItemProp]=r[h.selectedItemProp].replace(n,"<em>$1</em>"))):r[h.selectedItemProp].html(r[h.selectedItemProp].html().replace(n,"<em>$1</em>")),h.formatList?f=h.formatList.call(this,r,f):f=f.html(r[h.selectedItemProp]),E.append(f),r=null,i++;if(h.retrieveLimit&&h.retrieveLimit===i)break}m+=1}F.removeClass("loading"),i<=0&&E.html('<li class="as-message">'+h.emptyText+"</li>"),E.css({width:F.outerWidth()}),(i>0||h.showResultListWhenNoMatch)&&D.show(),a.isFunction(h.resultsComplete)&&h.resultsComplete.call(this)},w=function(a){var b,c,d;if(D.find(":visible").length){c=D.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=D.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}c.removeClass("active"),d.addClass("active")}},f=function(){if(!i)return;i.abort(),i=null},p.focus(function(){return b=a(this),!h.usePlaceholder&&b.val()===h.startText&&l.isEmpty()?b.val(""):q&&(F.find("li.as-selections-item").removeClass("blur"),b.val()!==""&&(E.css({width:F.outerWidth()}),D.show())),r&&clearInterval(r),r=setInterval(function(){h.showResultList&&(h.selectionLimit&&F.find("li.as-selection-item").length>=h.selectionLimit?(E.html('<li class="as-message">'+h.limitText+"</li>"),D.show()):t())},h.keyDelay),q=!0,h.minChars===0&&C(b.val()),!0}),p.blur(function(){b=a(this),!h.usePlaceholder&&b.val()===""&&l.isEmpty()&&z===""&&h.minChars>0?b.val(h.startText):q&&(F.find("li.as-selection-item").addClass("blur").removeClass("selected"),D.hide()),r&&clearInterval(r)}),p.keydown(function(b){var d,e,i,j,m,n;u=b.keyCode,e=!1;switch(b.keyCode){case 38:b.preventDefault(),w("up");break;case 40:b.preventDefault(),a(":visible",D).length>0?w("down"):(G&&clearTimeout(G),G=setTimeout(function(){t()},h.keyDelay));break;case 8:p.val()===""&&(n=l.getAll(),m=null,n.length?m=n[n.length-1]:m=null,F.children().not(g.prev()).removeClass("selected"),g.prev().hasClass("selected")?(l.remove(m),c.onSelectionRemove(this,g.prev(),h,null,l.getAll())):(c.onSelectionClick(this,g.prev(),h,null,l.getAll()),g.prev().addClass("selected"))),p.val().length===1&&(D.hide(),A="",f()),D.find(":visible").length&&(G&&clearTimeout(G),G=setTimeout(function(){t()},h.keyDelay));break;case 9:case 188:d=D.find("li.active:first"),h.canGenerateNewSelections&&(v=!0,i=p.val().replace(/(,)/g,""),i!==""&&!l.exist(i)&&i.length>=h.minChars&&d.length===0&&(b.preventDefault(),j={},j[""+h.selectedItemProp]=i,j[""+h.selectedValuesProp]=i,k(j,"00"+(F.find("li").length+1)),p.val(""),f())),d.length&&(v=!1,d.click(),D.hide(),b.preventDefault());break;case 13:v=!1,d=D.find("li.active:first"),d.length&&(d.click(),D.hide()),(h.neverSubmit||d.length)&&b.preventDefault();break;case 27:h.preventPropagationOnEscape&&D.find(":visible").length&&b.stopPropagation();break;case 16:case 20:f(),D.hide()}})})},add:function(a){return console.log(this)}},a.fn.autoSuggest=function(a){return g[a]?g[a].apply(this,Array.prototype.slice.call(arguments,1)):g.init.apply(this,arguments)}}).call(this);