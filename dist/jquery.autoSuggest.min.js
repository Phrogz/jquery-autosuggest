/*! jQuery AutoSuggest - v2.0.0 - 2012-09-10
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var e,t,n,r,i,s,o,u=[].slice;e=jQuery,i=function(){function t(){}return t.prototype._=void 0,t.escapeQuotes=function(e){if(e)return e.replace(/"/g,'\\"')},t.escapeHtml=function(t){return e("<span/>").text(t).html()},t.setPlaceholderEnabled=function(e,t){var n,r,i;r=["placeholder","disabled-placeholder"],t?(n=r[1],i=r[0]):(n=r[0],i=r[1]);if(e.attr(i)||!e.attr(n))return;e.attr(i,function(){return e.attr(n)}),e.removeAttr(n)},t}(),t=function(){function t(){}return t.prototype._=void 0,t.getExtraParams=function(t){var n,r,i,s,o,u,a;s=t.extraParams,e.isFunction(s)&&(s=s(this));if(e.type(s)==="string"){n={},a=s.split("&");for(o=0,u=a.length;o<u;o++){r=a[o];if(r==="")continue;i=r.split("=",2),i.length&&(n[i[0]]=i[1])}s=n}return s},t}(),r=function(){function t(e,t){this.hiddenField=e,this.items=t!=null?t:[]}return t.prototype._=void 0,t.prototype.hiddenField=null,t.prototype.items=null,t.prototype.syncToHiddenField=function(){var e,t,n,r,i;if(!this.hiddenField)return;t="",i=this.items;for(n=0,r=i.length;n<r;n++)e=i[n],t+=","+e;t&&(t+=","),this.hiddenField.val(t||",")},t.prototype.add=function(e){this.exist(e)||this.items.push(e),this.syncToHiddenField()},t.prototype.remove=function(t){this.items=e.grep(this.items,function(e){return e!==t}),this.syncToHiddenField()},t.prototype.isEmpty=function(){return this.items.length===0},t.prototype.exist=function(t){return e.inArray(t,this.items)!==-1},t.prototype.getAll=function(){return this.items.slice(0)},t.prototype.clear=function(){this.items=[],this.syncToHiddenField()},t}(),n=function(){function t(){}return t.onSelectionAdd=function(t,n,r,s,o,u){var a;a=s.onSelectionAdd.call(t,n,r,s),i.setPlaceholderEnabled(t,u.length===0),e.isFunction(s.afterSelectionAdd)&&s.afterSelectionAdd.call(t,a,o,u)},t.onSelectionRemove=function(t,n,r,s,o){e.isFunction(r.onSelectionRemove)&&r.onSelectionRemove.call(t,n,r),i.setPlaceholderEnabled(t,o.length===0),e.isFunction(r.afterSelectionRemove)&&r.afterSelectionRemove.call(t,n,s,o)},t.onSelectionClick=function(t,n,r,s,o){e.isFunction(r.afterSelectionClick)&&r.afterSelectionClick.call(t,n,s,o),i.setPlaceholderEnabled(t,o.length===0)},t}(),s={asHtmlID:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",emptyTextPlaceholder:/\{\d+\}/,limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(e,t,n){return e.before(t),e.prev()},onSelectionRemove:function(e,t){return t.fadeOut?e.fadeOut(t.fadeOut,function(){return e.remove()}):e.remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,onResultItemClick:null,afterResultListShow:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,remoteFilter:!1},o={init:function(o,u){var a,f;u=e.extend({},s,u),a=null,u.remoteFilter==="auto"&&(u.remoteFilter=e.type(o)==="string"),f=function(){switch(e.type(o)){case"function":return o;case"string":return function(n,r){var i,s,f,l;l={},l[""+u.queryParam]=encodeURIComponent(decodeURIComponent(n)),u.retrieveLimit&&(l[u.limitParam]=encodeURIComponent(u.retrieveLimit)),s=t.getExtraParams(u),e.type(s)==="object"&&e.extend(l,s),i=e.extend({},u.ajaxOptions,{url:o,data:l}),f=function(t){return e.isFunction(u.afterRequest)&&(t=u.afterRequest.apply(this,[t])),r(t,n)},a=e.ajax(i).done(f),u.onAjaxRequestDone&&a.done(u.onAjaxRequestDone),u.onAjaxRequestFail&&a.fail(u.onAjaxRequestFail),u.onAjaxRequestAlways&&a.always(u.onAjaxRequestAlways)};case"array":case"object":return function(e,t){return t(o,e)}}}();if(!f)return;return this.each(function(t){var s,o,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R;u.inputAttrs=e.extend(u.inputAttrs,{}),g=!1,v=e(this),t=null,h=null,u.asHtmlID?(t=u.asHtmlID,h=t):(t=""+(t||"")+Math.floor(Math.random()*100),h="as-input-"+t),u.inputAttrs.id=h,u.usePlaceholder||(u.inputAttrs.placeholder=u.startText),v.attr(u.inputAttrs),v.addClass("as-input"),u.usePlaceholder||v.val(u.startText),v.wrap('<ul class="as-selections" id="as-selections-'+t+'"></ul>').wrap('<li class="as-original" id="as-original-'+t+'"></li>'),D=e("#as-selections-"+t),m=e("#as-original-"+t),M=e('<div class="as-results" id="as-results-'+t+'"></div>'),_=e('<ul class="as-list"></ul>'),p=e('<input type="hidden" class="as-values" name="as_values_'+t+'" id="as-values-'+t+'" />'),c=new r(p),C="",y=null,P=null,k="",S=!1,E=null,N=0,O={add:function(t){var n,r;n=e(D).find("li").length,r=o(t,"u"+n),r!=null&&r.addClass("blur")},remove:function(e){c.remove(e),D.find('li[data-value="'+i.escapeHtml(e)+'"]').remove()}},l=function(){return{add:O.add,remove:O.remove}},v.bind("addSelection",function(e,t){return O.add(t)}),v.bind("removeSelection",function(e,t){return O.remove(t)}),o=function(r,s){var o,a;return c.add(r[u.selectedValuesProp]),a=e('<li class="as-selection-item" id="as-selection-'+s+'" data-value="'+i.escapeQuotes(i.escapeHtml(r[u.selectedValuesProp]))+'"></li>'),a.on({click:function(){t=e(this),n.onSelectionClick(v,t,u,r[u.selectedValuesProp],c.getAll()),D.children().removeClass("selected"),t.addClass("selected")},mousedown:function(){g=!1}}),o=e('<a class="as-close">&times;</a>'),o.click(function(){return c.remove(r[u.selectedValuesProp]),n.onSelectionRemove(v,a,u,null,c.getAll()),g=!0,v.focus(),!1}),typeof r[u.selectedItemProp]!="string"?n.onSelectionAdd(v,m,a.append(r[u.selectedItemProp]).prepend(o),u,r,c.getAll()):n.onSelectionAdd(v,m,a.text(r[u.selectedItemProp]).prepend(o),u,r,c.getAll()),m.prev()},e.isFunction(u.start)&&u.start.call(this,l());switch(e.type(u.preFill)){case"string":q=u.preFill.split(",");for(B=0,F=q.length;B<F;B++)H=q[B],b={},b[""+u.selectedValuesProp]=H,H!==""&&o(b,"000"+d);C=u.preFill;break;case"array":C="";if(u.preFill.length){e.isFunction(u.afterRequest)&&(u.preFill=u.afterRequest.call(this,u.preFill)),R=u.preFill;for(d=j=0,I=R.length;j<I;d=++j)b=R[d],T=b[u.selectedValuesProp],typeof T=="undefined"&&(T=""),C+=T+",",T!==""&&o(b,"000"+d)}}return C!==""&&(v.val(""),D.find("li.as-selection-item").addClass("blur").removeClass("selected"),i.setPlaceholderEnabled(v,!1)),v.after(p),D.on({click:function(){g=!0,v.focus()},mousedown:function(){D.children().removeClass("selected"),g=!1}}),D.after(M),w=function(){var e;if(E===46||E>8&&E<32){M.hide();return}e=v.val().replace(/[\\]+|[\/]+/g,"");if(e!==""&&e===k)return;return k=e,e.length>=u.minChars||u.minChars===0&&e.length===0?(D.addClass("loading"),A(e)):(D.removeClass("loading"),M.hide())},A=function(t){return e.isFunction(u.beforeRequest)&&(t=u.beforeRequest.apply(this,[t,u])),s(),f(t,L)},L=function(n,r){var s,a,f,l,h,p,d,m,y,w,E,x,T,C,L;u.matchCase||(r=r.toLowerCase()),r=r.replace("(","(","g").replace(")",")","g"),f=0,M.hide().html(_.html("")),h=0;for(E=0,T=n.length;E<T;E++){b=n[E],N++,a=!1;if(u.searchObjProps==="value")m=b.value;else{m="",L=u.searchObjProps.split(",");for(x=0,C=L.length;x<C;x++)l=L[x],m+=""+b[e.trim(l)]+" "}if(m){u.matchCase||(m=m.toLowerCase());if(!u.searchActive||(m.indexOf(r)!==-1||u.remoteFilter)&&!c.exist(b[u.selectedValuesProp]))a=!0}if(a){s=e('<li class="as-result-item" id="as-result-item-'+h+'"></li>'),s.click(function(){var r,i;t=e(this),i=t.data("data"),r=i.num,D.find("#as-selection-"+r).length<=0&&!S&&(n=i.attributes,v.val("").focus(),k="",o(n,r),e.isFunction(u.onResultItemClick)&&u.onResultItemClick.call(this,i),M.hide()),S=!1}),s.mousedown(function(){g=!1}),s.mouseover(function(){t=e(this),_.find("li").removeClass("active"),t.addClass("active")}),s.data("data",{attributes:n[h],num:N}),w=e.extend({},n[h]),r=r.replace(/"/g,'\\"'),p=u.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(r)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(r)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof w[u.selectedItemProp]=="string"?(w[u.selectedItemProp]=i.escapeHtml(w[u.selectedItemProp]),u.resultsHighlight&&r.length>0&&(w[u.selectedItemProp]=w[u.selectedItemProp].replace(p,"<em>$1</em>"))):w[u.selectedItemProp].html(w[u.selectedItemProp].html().replace(p,"<em>$1</em>")),u.formatList?s=u.formatList.call(this,w,s):s=s.html(w[u.selectedItemProp]),_.append(s),w=null,f++;if(u.retrieveLimit&&u.retrieveLimit===f)break}h+=1}D.removeClass("loading"),f<=0&&(y=u.emptyText,e.type(u.emptyTextPlaceholder)==="regexp"&&(y=y.replace(u.emptyTextPlaceholder,r)),_.html('<li class="as-message">'+y+"</li>")),_.css({width:D.outerWidth()}),d=f>0||u.showResultListWhenNoMatch,d&&M.show(),e.isFunction(u.afterResultListShow)&&u.afterResultListShow.call(this,d)},x=function(e){var t,n,r;if(M.find(":visible").length){n=M.find("li");switch(e){case"down":r=n.eq(0);break;default:r=n.filter(":last")}t=M.find("li.active:first");if(t.length)switch(e){case"down":r=t.next();break;default:r=t.prev()}n.removeClass("active"),r.addClass("active")}},s=function(){if(!a)return;a.abort(),a=null},v.on({focus:function(){return t=e(this),!u.usePlaceholder&&t.val()===u.startText&&c.isEmpty()?t.val(""):g&&(D.find("li.as-selections-item").removeClass("blur"),t.val()!==""&&(_.css({width:D.outerWidth()}),M.show())),y&&clearInterval(y),y=setInterval(function(){u.showResultList&&(u.selectionLimit&&D.find("li.as-selection-item").length>=u.selectionLimit?(_.html('<li class="as-message">'+u.limitText+"</li>"),M.show()):w())},u.keyDelay),g=!0,u.minChars===0&&A(t.val()),!0},blur:function(){t=e(this),!u.usePlaceholder&&t.val()===""&&c.isEmpty()&&C===""&&u.minChars>0?t.val(u.startText):g&&(D.find("li.as-selection-item").addClass("blur").removeClass("selected"),M.hide()),y&&clearInterval(y),i.setPlaceholderEnabled(t,c.isEmpty())},keydown:function(t){var r,a,f,l,h,p;E=t.keyCode,a=!1;switch(t.keyCode){case 38:t.preventDefault(),x("up");break;case 40:t.preventDefault(),e(":visible",M).length>0?x("down"):(P&&clearTimeout(P),P=setTimeout(function(){w()},u.keyDelay));break;case 8:v.val()===""&&(p=c.getAll(),h=null,p.length?h=p[p.length-1]:h=null,D.children().not(m.prev()).removeClass("selected"),m.prev().hasClass("selected")?(c.remove(h),n.onSelectionRemove(v,m.prev(),u,null,c.getAll())):(n.onSelectionClick(v,m.prev(),u,null,c.getAll()),m.prev().addClass("selected"))),v.val().length===1&&(M.hide(),k="",s()),M.find(":visible").length&&(P&&clearTimeout(P),P=setTimeout(function(){w()},u.keyDelay));break;case 9:case 188:r=M.find("li.active:first"),u.canGenerateNewSelections&&(S=!0,f=v.val().replace(/(,)/g,""),f!==""&&!c.exist(f)&&f.length>=u.minChars&&r.length===0&&(t.preventDefault(),l={},l[""+u.selectedItemProp]=f,l[""+u.selectedValuesProp]=f,o(l,"00"+(D.find("li").length+1)),v.val(""),s())),r.length&&(S=!1,r.click(),M.hide(),t.preventDefault());break;case 13:S=!1,r=M.find("li.active:first"),r.length&&(r.click(),M.hide()),(u.neverSubmit||r.length)&&t.preventDefault();break;case 27:u.preventPropagationOnEscape&&M.find(":visible").length&&t.stopPropagation();break;case 16:case 20:s(),M.hide()}i.setPlaceholderEnabled(v,c.isEmpty())}})})},add:function(){var t,n,r,i,s;r=1<=arguments.length?u.call(arguments,0):[],t=e(this);for(i=0,s=r.length;i<s;i++)n=r[i],t.trigger("addSelection",n)},remove:function(){var t,n,r,i,s;r=1<=arguments.length?u.call(arguments,0):[],t=e(this);for(i=0,s=r.length;i<s;i++)n=r[i],t.trigger("removeSelection",n)}},e.fn.autoSuggest=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):o.init.apply(this,arguments)}}).call(this);