/*! jQuery AutoSuggest - v2.0.0 - 2012-09-01
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c,d,e;a=jQuery,e=function(){function b(){}return b.prototype._=void 0,b.escapeQuotes=function(a){if(a)return a.replace(/"/g,'\\"')},b.escapeHtml=function(b){return a("<span/>").text(b).html()},b}(),b=function(){function b(){}return b.prototype._=void 0,b.getExtraParams=function(b){var c,d,e,f,g,h,i;f=b.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){c={},i=f.split("&");for(g=0,h=i.length;g<h;g++){d=i[g];if(d==="")continue;e=d.split("=",2),e.length&&(c[e[0]]=e[1])}f=c}return f},b}(),d=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype._=void 0,b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),c=function(){function b(){}return b.onSelectionAdded=function(b,c,d,e,f){if(a.isFunction(d.selectionAdded))return d.selectionAdded.call(b,c,e,f)},b.onSelectionRemoved=function(b,c,d,e,f){return a.isFunction(d.selectionRemoved)&&d.selectionRemoved.call(b,c,e,f),c.remove()},b.onSelectionClicked=function(b,c,d,e,f){if(a.isFunction(d.selectionClick))return d.selectionClick.call(b,c,e,f)},b}(),a.fn.autoSuggest=function(f,g){var h,i,j;i={asHtmlID:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,selectionClick:null,selectionAdded:null,selectionRemoved:null,formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,resultClick:null,resultsComplete:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"}},g=a.extend({},i,g),h=null,j=function(){switch(a.type(f)){case"function":return f;case"string":return function(c,d){var e,i,j,k;k={},k[""+g.queryParam]=encodeURIComponent(decodeURIComponent(c)),g.retrieveLimit&&(k[g.limitParam]=encodeURIComponent(g.retrieveLimit)),i=b.getExtraParams(g),a.type(i)==="object"&&a.extend(k,i),e=a.extend({},g.ajaxOptions,{url:f,data:k}),j=function(b){var e;return e=a.isFunction(g.afterRequest)?g.afterRequest.apply(this,[b]):b,d(e,c)},h=a.ajax(e).done(j),g.onAjaxRequestDone&&h.done(g.onAjaxRequestDone),g.onAjaxRequestFail&&h.fail(g.onAjaxRequestFail),g.onAjaxRequestAlways&&h.always(g.onAjaxRequestAlways)};case"array":case"object":return function(a,b){return b(f,a)}}}();if(!j)return;return this.each(function(b){var f,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;g.inputAttrs=a.extend(g.inputAttrs,{}),q=!1,p=a(this),b=null,m=null,g.asHtmlID?(b=g.asHtmlID,m=b):(b=""+(b||"")+Math.floor(Math.random()*100),m="as-input-"+b),g.inputAttrs.id=m,g.usePlaceholder&&(g.inputAttrs.placeholder=g.startText),p.attr(g.inputAttrs),p.addClass("as-input"),g.usePlaceholder||p.val(g.startText),p.wrap('<ul class="as-selections" id="as-selections-'+b+'"></ul>').wrap('<li class="as-original" id="as-original-'+b+'"></li>'),F=a("#as-selections-"+b),i=a("#as-original-"+b),D=a('<div class="as-results" id="as-results-'+b+'"></div>'),E=a('<ul class="as-list"></ul>'),n=a('<input type="hidden" class="as-values" name="as_values_'+b+'" id="as-values-'+b+'" />'),l=new d(n),z="",r=null,G=null,A="",v=!1,u=null,y=0,k=function(d,f){var h,j;return l.add(d[g.selectedValuesProp]),j=a('<li class="as-selection-item" id="as-selection-'+f+'" data-value="'+e.escapeQuotes(e.escapeHtml(d[g.selectedValuesProp]))+'"></li>'),j.click(function(){b=a(this),a.isFunction(g.selectionClick)&&g.selectionClick.call(this,b),F.children().removeClass("selected"),b.addClass("selected")}),j.mousedown(function(){q=!1}),h=a('<a class="as-close">&times;</a>'),h.click(function(){return l.remove(d[g.selectedValuesProp]),a.isFunction(g.selectionRemoved)&&g.selectionRemoved.call(this,j),j.remove(),q=!0,p.focus(),!1}),typeof d[g.selectedItemProp]!="string"?i.before(j.append(d[g.selectedItemProp]).prepend(h)):i.before(j.text(d[g.selectedItemProp]).prepend(h)),c.onSelectionAdded(this,i.prev(),g,d[g.selectedValuesProp],l.getAll()),i.prev()},a.isFunction(g.start)&&g.start.call(this,{add:function(b){var c,d;return c=a(F).find("li").length,d=k(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return l.remove(a),F.find('li[data-value="'+e.escapeHtml(a)+'"]').remove()}});switch(a.type(g.preFill)){case"string":M=g.preFill.split(",");for(I=0,K=M.length;I<K;I++)H=M[I],s={},s[""+g.selectedValuesProp]=H,H!==""&&k(s,"000"+o);z=g.preFill;break;case"array":z="";if(g.preFill.length){N=g.preFill;for(o=J=0,L=N.length;J<L;o=++J)s=N[o],x=s[g.selectedValuesProp],typeof x=="undefined"&&(x=""),z+=x+",",x!==""&&k(s,"000"+o)}}return z!==""&&(p.val(""),F.find("li.as-selection-item").addClass("blur").removeClass("selected")),p.after(n),F.click(function(){q=!0,p.focus()}),F.mousedown(function(){F.children().removeClass("selected"),q=!1}),F.after(D),t=function(){var a;if(u===46||u>8&&u<32){D.hide();return}a=p.val().replace(/[\\]+|[\/]+/g,"");if(a!==""&&a===A)return;return A=a,a.length>=g.minChars||g.minChars===0&&a.length===0?(F.addClass("loading"),C(a)):(F.removeClass("loading"),D.hide())},C=function(b){return a.isFunction(g.beforeRequest)&&(b=g.beforeRequest.apply(this,[b,g])),f(),j(b,B)},B=function(c,d){var f,h,i,j,m,n,o,r,t,u,w,x,z;g.matchCase||(d=d.toLowerCase()),d=d.replace("(","(","g").replace(")",")","g"),i=0,D.hide().html(E.html("")),m=0;for(t=0,w=c.length;t<w;t++){s=c[t],y++,h=!1;if(g.searchObjProps==="value")o=s.value;else{o="",z=g.searchObjProps.split(",");for(u=0,x=z.length;u<x;u++)j=z[u],o+=""+s[a.trim(j)]+" "}if(o){g.matchCase||(o=o.toLowerCase());if(!g.searchActive||o.indexOf(d)!==-1&&!l.exist(s[g.selectedValuesProp]))h=!0}if(h){f=a('<li class="as-result-item" id="as-result-item-'+m+'"></li>'),f.click(function(){var d,e;b=a(this),e=b.data("data"),d=e.num,F.find("#as-selection-"+d).length<=0&&!v&&(c=e.attributes,p.val("").focus(),A="",k(c,d),a.isFunction(g.resultClick)&&g.resultClick.call(this,e),D.hide()),v=!1}),f.mousedown(function(){q=!1}),f.mouseover(function(){b=a(this),E.find("li").removeClass("active"),b.addClass("active")}),f.data("data",{attributes:c[m],num:y}),r=a.extend({},c[m]),d=d.replace(/"/g,'\\"'),n=g.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(d)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(d)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof r[g.selectedItemProp]=="string"?(r[g.selectedItemProp]=e.escapeHtml(r[g.selectedItemProp]),g.resultsHighlight&&d.length>0&&(r[g.selectedItemProp]=r[g.selectedItemProp].replace(n,"<em>$1</em>"))):r[g.selectedItemProp].html(r[g.selectedItemProp].html().replace(n,"<em>$1</em>")),g.formatList?f=g.formatList.call(this,r,f):f=f.html(r[g.selectedItemProp]),E.append(f),r=null,i++;if(g.retrieveLimit&&g.retrieveLimit===i)break}m+=1}F.removeClass("loading"),i<=0&&E.html('<li class="as-message">'+g.emptyText+"</li>"),E.css({width:F.outerWidth()}),(i>0||g.showResultListWhenNoMatch)&&D.show(),a.isFunction(g.resultsComplete)&&g.resultsComplete.call(this)},w=function(a){var b,c,d;if(D.find(":visible").length){c=D.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=D.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}c.removeClass("active"),d.addClass("active")}},f=function(){if(!h)return;h.abort(),h=null},p.focus(function(){return b=a(this),!g.usePlaceholder&&b.val()===g.startText&&l.isEmpty()?b.val(""):q&&(F.find("li.as-selections-item").removeClass("blur"),b.val()!==""&&(E.css({width:F.outerWidth()}),D.show())),r&&clearInterval(r),r=setInterval(function(){g.showResultList&&(g.selectionLimit&&F.find("li.as-selection-item").length>=g.selectionLimit?(E.html('<li class="as-message">'+g.limitText+"</li>"),D.show()):t())},g.keyDelay),q=!0,g.minChars===0&&C(b.val()),!0}),p.blur(function(){b=a(this),!g.usePlaceholder&&b.val()===""&&l.isEmpty()&&z===""&&g.minChars>0?b.val(g.startText):q&&(F.find("li.as-selection-item").addClass("blur").removeClass("selected"),D.hide()),r&&clearInterval(r)}),p.keydown(function(b){var d,e,h,j,m,n;u=b.keyCode,e=!1;switch(b.keyCode){case 38:b.preventDefault(),w("up");break;case 40:b.preventDefault(),a(":visible",D).length>0?w("down"):(G&&clearTimeout(G),G=setTimeout(function(){t()},g.keyDelay));break;case 8:p.val()===""&&(n=l.getAll(),m=null,n.length?m=n[n.length-1]:m=null,F.children().not(i.prev()).removeClass("selected"),i.prev().hasClass("selected")?(l.remove(m),c.onSelectionRemoved(this,i.prev(),g,null,l.getAll())):(c.onSelectionClicked(this,i.prev(),g,null,l.getAll()),i.prev().addClass("selected"))),p.val().length===1&&(D.hide(),A="",f()),D.find(":visible").length&&(G&&clearTimeout(G),G=setTimeout(function(){t()},g.keyDelay));break;case 9:case 188:d=D.find("li.active:first"),g.canGenerateNewSelections&&(v=!0,h=p.val().replace(/(,)/g,""),h!==""&&!l.exist(h)&&h.length>=g.minChars&&d.length===0&&(b.preventDefault(),j={},j[""+g.selectedItemProp]=h,j[""+g.selectedValuesProp]=h,k(j,"00"+(F.find("li").length+1)),p.val(""),f())),d.length&&(v=!1,d.click(),D.hide(),b.preventDefault());break;case 13:v=!1,d=D.find("li.active:first"),d.length&&(d.click(),D.hide()),(g.neverSubmit||d.length)&&b.preventDefault();break;case 27:g.preventPropagationOnEscape&&D.find(":visible").length&&b.stopPropagation();break;case 16:case 20:f(),D.hide()}})})}}).call(this);